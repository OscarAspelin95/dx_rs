FROM rust:1.90-bookworm AS builder

WORKDIR /app

COPY . .

RUN apt-get update && apt-get install -y \
    # Dioxus essential packages.
    libwebkit2gtk-4.1-dev \
    build-essential \
    curl \
    wget \
    file \
    libxdo-dev \
    libssl-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev \
    && rustup target add wasm32-unknown-unknown \
    # install cargo binstall, easiest way to get the dioxus cli.
    && cargo install dioxus-cli --version 0.7.0-rc.2


RUN cargo clean && cargo build --release && dx build --release

RUN cargo install miniserve

EXPOSE 3000

ENTRYPOINT ["miniserve", "/app/dist", "--port", "3000"]
